## DaJet Script

[Реляционные базы данных](https://github.com/zhichkin/dajet/tree/main/doc/dajet-script/databases/README.md)

### Команда UPDATE

**Пример потокового UPDATE**

Данный вариант команды **UPDATE** с предложением **OUTPUT** работает аналогично команде **STREAM** - это потоковая команда.

```SQL
-- ***********************************************************************
-- * Источник сообщений SQL Server - регистр сведений "ИсходящаяОчередь" *
-- ***********************************************************************
USE "mssql://server/source_database"

DECLARE @empty_uuid uuid = "00000000-0000-0000-0000-000000000000"
DECLARE @ЭтотУзел string = SELECT Код
                             FROM ПланОбмена.ПланОбменаДанными
                            WHERE Предопределённый <> @empty_uuid
DECLARE @message object

UPDATE РегистрСведений.ИсходящаяОчередь
 WHERE Статус = Перечисление.СтатусСообщения.Создано
   SET Статус = Перечисление.СтатусСообщения.Отправлено
     , ДатаВремя = NOW()
OUTPUT ТипСообщения, ТелоСообщения
  INTO @message

-- ************************************************************************
-- * Приёмник сообщений PostgreSQL - регистр сведений "ВходящиеСообщения" *
-- ************************************************************************
USE "pgsql://postgres:postgres@127.0.0.1:5432/target_database"

INSERT РегистрСведений.ВходящиеСообщения
SELECT НомерСообщения = VECTOR('so_incoming_queue')
     , Отправитель    = @ЭтотУзел
     , ТипСообщения   = @message.ТипСообщения
     , ТелоСообщения  = @message.ТелоСообщения
     , ОтметкаВремени = NOW()

END -- Контекст базы данных приёмника
END -- Контекст базы данных источника
```

[Наверх](#команда-update)
