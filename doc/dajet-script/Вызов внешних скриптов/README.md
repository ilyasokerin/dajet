## DaJet Script

[Начало](https://github.com/zhichkin/dajet/tree/main/doc/dajet-script/README.md)

### Вызов внешних скриптов

Вызов одного скрипта DaJet Script из другого выполняется при помощи команды **EXECUTE**. Синтаксис этой команды выглядит следующим образом:

```SQL
EXECUTE 'file://<script>' [WITH <parameters>] [INTO <variable>]
```
**\<script\>** - путь или шаблон пути к файлу вызываемого скрипта относительно корневого каталога выполнения утилиты или сервера DaJet.<br>
**\<parameters\>** - (опционально) сопоставление имён параметров вызываемого и вызывающего скриптов.<br>
**\<variable\>** - (опционально) переменная вызывающего скрипта, в которую вызываемый скрипт возвращает результат своего выполнения при помощи команды **RETURN**.

Если предложение **WITH** команды **EXECUTE** не используется, тогда вызываемый скрипт выполняется без передачи в него каких-либо параметров. Если же не используется предложение **INTO**, тогда скрипт выполняется в качестве процедуры, невозвращающей никакого значения.

> Скрипты могут вызываться рекурсивно, то есть скрипт может вызывать сам себя.

Обычный путь к файлу вызываемого скрипта выглядит следующим очевидным образом:
```SQL
EXECUTE 'file://script.djs'
```

Шаблон пути к файлу вызываемого скрипта включает в себя переменные или обращения к свойствам объектов типа ```object``` для динамической подстановки значений (переменные шаблона). Эти переменные заключаются в фигурные скобки ```{``` и ```}```. Например, если есть каталог ```scripts```, то динамическое обращение к скриптам, расположенным в нём, выполняется следующим образом:

```SQL
DECLARE @file string = 'script1.djs'

EXECUTE 'file://scripts/{@file}'

-- После подстановки значения переменной @file в шаблон,
-- путь к файлу вызываемого скрипта будет выглядеть так:
-- file://scripts/script1.djs
```

Рассмотрим простой пример вызова внешнего скрипта. В этом примере ```callee.djs``` - это вызываемый внешний скрипт, а ```caller.djs``` - вызывающий (корневой) скрипт. Предположим, что оба скрипта находятся в корне каталога выполнения утилиты или сервера DaJet.

```SQL
-- **************
-- * callee.djs *
-- **************
DECLARE @input  string -- Входящий параметр
DECLARE @result string -- Возвращаемый результат

SET @result = 'Hello, ' + @input + '!'

RETURN @result
```

```SQL
-- **************
-- * caller.djs *
-- **************
DECLARE @input  string -- Передаваемый во внешний скрипт параметр
DECLARE @output string -- Результат выполнения скрипта

SET @input = 'caller'

EXECUTE 'file://callee.djs'
   WITH input = @input -- Сопоставление входящего параметра
   INTO @output        -- Переменная для получения возврата

RETURN @output

-- Результат выполнения скрипта:
-- Hello, caller!
```

Пример выше показывает каким образом, при помощи предложения **WITH** и знака равенства ```=```, выполняется сопоставление входящих параметров вызываемого скрипта и переменных вызывающего. Слева от знака ```=``` указывается имя переменной вызываемого скрипта без специального символа ```@```, а справа - полное имя переменной вызывающего скрипта, значение которой нужно передать. Если входящих параметров больше одного, то пары сопоставления отделяются друг от друга при помощи символа ```,``` (запятой).

[Наверх](#вызов-внешних-скриптов)
