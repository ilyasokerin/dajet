## DaJet Script

### Система типов данных

Система типов данных DaJet Script заимствована у платформы 1С:Предприятие 8. Однако, в отличие от 1С, DaJet Script - это строго типизированный язык программирования. Такое наследование системы типов обусловлено тем, что изначально DaJet Script разрабатывался как инструмент тесной интеграции информационных баз именно платформы 1С:Предприятие 8 между собой при помощи брокера сообщений RabbitMQ. Таким образом DaJet Script, кроме всего прочего, поддерживает такие специфичные для этой платформы типы данных, как Ссылка (Entity) и СоставнойТип (Union).

**Таблица типов данных DaJet Script**
|**1С:Предприятие 8**|**DaJet Script**|**C#**|**MS SQL Server**|**PostgreSQL**|
|--------------------|----------------|------|-----------------|--------------|
|Неопределено|null|null|NULL|NULL|
|Булево|boolean|bool|binary(1)|boolean|
|Число|number|decimal<br>int|numeric<br>int|numeric<br>integer|
|Дата|datetime|DateTime|datetime2|timestamp<br>without time zone|
|Строка|string|string|nchar<br>nvarchar|mchar<br>mvarchar|
|Ссылка|entity|[Entity](https://github.com/zhichkin/dajet/blob/main/src/dajet-model/core/Entity.cs)|binary(16)|bytea|
|Составной тип|union|[Union](https://github.com/zhichkin/dajet/blob/main/src/dajet-model/core/Union.cs)|Все выше<br>перечисленные|Все выше<br>перечисленные|
|Бинарные данные|binary|byte[]|varbinary|bytea|
|Уникальный<br>идентификатор|uuid|Guid|binary(16)|bytea|
|Структура|object|[DataObject](https://github.com/zhichkin/dajet/blob/main/src/dajet-model/data/DataObject.cs)|UDT|UDT|
|Массив|array|List\<DataObject\>|UDT|UDT|

### Тип данных "Ссылка"

Ссылочные типы данных 1С:Предприятие 8 - это сущности, которые идентифицируются по уникальному ключу, и на них можно ссылаться в свойствах других объектов или на уровне полей таблиц базы данных (первичные и внешние ключи). Например, к таким типам данных относятся справочники и документы.

> Перечисления 1С:Предприятие 8 тоже являются ссылочным типом данных, что не очевидно, но факт.

Ссылка - это структура данных, которая на уровне СУБД состоит из одного или двух полей. Данная структура является указателем (ссылкой) на конкретный объект в базе данных или его отсутствие - "пустая ссылка".

|**1С:Предприятие 8**|**DaJet Script**|**C#**|**MS SQL Server**|**PostgreSQL**|**Поле СУБД**|
|---|---|---|---|---|---|
|Код типа|entity|int|binary(4)|bytea|_TRef|
|Ссылка|entity|Guid|binary(16)|bytea|_RRef|

> Ссылка всегда строго типизированна, то есть даже "пустая ссылка" указывает на отсутствие объекта определённого типа, например, "Справочник.Номенклатура".

### Тип данных "Составной тип"

Составной тип - это структура данных, которая на уровне СУБД состоит из нескольких полей. Данный тип данных является реализацией дискриминированного объединения (tagged union).

|**1С:Предприятие 8**|**DaJet Script**|**C#**|**MS SQL Server**|**PostgreSQL**|**Поле СУБД**|
|--------------------|----------------|------|-----------------|--------------|-------------|
|Дискриминатор|number|byte|binary(1)|bytea|_TYPE|
|Булево|boolean|bool|binary(1)|boolean|_L|
|Число|number|decimal<br>int|numeric|numeric|_N|
|Дата|datetime|DateTime|datetime2|timestamp<br>without time zone|_T|
|Строка|string|string|nchar<br>nvarchar|mchar<br>mvarchar|_S|
|Число|entity|int|numeric|bytea|_RTRef|
|Ссылка|entity|Guid|binary(16)|_RRRef|

### Типы данных object и array

Типы данных ```object``` и ```array``` наиболее всего соответствуют одноимённым типам данных JavaScript. Для 1С:Предприятие 8 наиболее близким сопоставлением будут: "Структура" и "Массив". Они используются для универсализации системы типов данных среды выполнения DaJet Script, чтобы "подружить" узлы интеграции, имеющие различные системы типов данных, между собой.

### Полезные ссылки и дополнительные материалы

[Анатомия метаданных 1С:Предприятие 8](https://github.com/zhichkin/dajet/blob/main/doc/metadata-internals/README.md)

[Размещение данных 1С:Предприятия 8](https://its.1c.ru/db/metod8dev/content/1591/hdoc)

[Размещение данных 1С:Предприятия 8 (таблицы и поля)](https://its.1c.ru/db/metod8dev/content/1798/hdoc)

[Особенности хранения составных типов данных 1С:Предприятия 8](https://its.1c.ru/db/metod8dev/content/1828/hdoc)

### Литералы и кодирование в формат JSON

|**1С:Предприятие 8**|**DaJet Script**|**Литерал**|**JSON**|
|--------------------|----------------|-----------|--------|
|Неопределено|null|null|null|
|Булево|boolean|true или false|true или false|
|Число|number|1 или 1.0|1 или 1.0|
|Дата|datetime|"2024-01-01T00:00:00"|"2024-01-01T00:00:00"|
|Строка|string|'это строка'|"это строка"|
|Бинарные данные|binary|0xFF|BASE64|
|Уникальный<br>идентификатор|uuid|'35521B2A-B154-4CA5-97FC-AE5733C4E473'|"35521B2A-B154-4CA5-97FC-AE5733C4E473"|
|Ссылка|entity|{123:35521B2A-B154-4CA5-97FC-AE5733C4E473}|"{123:35521B2A-B154-4CA5-97FC-AE5733C4E473}"|
|Составной тип|union|нет|{<br>&nbsp;&nbsp;&nbsp;&nbsp;"type": "string",<br>&nbsp;&nbsp;&nbsp;&nbsp;"value": "это строка"<br>}|
