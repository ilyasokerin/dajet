## Утилита для выполнения скриптов DaJet

### Установка

1. Установить [Microsoft .NET 8 SDK](https://dotnet.microsoft.com/en-us/download/dotnet/8.0)
2. Скачать [дистрибутив утилиты DaJet](https://github.com/zhichkin/dajet/releases)
3. Создать рабочий каталог и распаковать дистрибутив, например, ```C:\dajet-utility```
4. Перейти в каталог установки и выполнить тестовый скрипт ```./scripts/test.djs```
```SQL
PRINT 'Hello from DaJet!'
```
В случае, если тестовый скрипт по указанному пути отстутствует, то создайте его самостоятельно.

Результат выполнения скрипта должен быть следующим:

![Тестовый скрипт DaJet](https://github.com/zhichkin/dajet/blob/main/doc/img/dajet-utility-test-windows.png)

### Описание

Утилита **dajet** используется для хостинга (регулярного) или одноразового выполнения скриптов DaJet.

Исполняемый файл **dajet** находится в корневом каталоге установки, может быть сконфигурирован для запуска как служба **Windows** или демон **Linux** (_поддерживается **systemd**_). Может также выполняться как обычный exe-файл, например, из консоли.

Исполняемый файл **dajet** имеет один необязательный параметр запуска - **путь к файлу настроек сервиса**.
> Файл настроек должен быть в формате JSON с кодировкой UTF-8.

### Запуск сервиса DaJet Stream
(из корневого каталога установки)

|**Параметр**|**Windows**|**Linux**|
|---------------|-------|-------|
| Нет | dajet | dotnet ./dajet.dll |
| Да | dajet ./config.json | dotnet ./dajet.dll ./config.json |

> Если файл настроек при запуске сервиса не указан, то будут использоваться значения по умолчанию.

### Значения настроек сервиса по умолчанию

|**Наименование**|**Тип значения**|**Значение**|**Описание**|
|---------------|-------|-------|-------|
| LogSize | Число | 1048576 | Макисмальный размер лога службы в байтах |
| LogFile | Строка | dajet.log | Наименование файла лога службы |
| LogPath | Строка | ./ | Каталог размещения файла лога службы |
| RootPath | Строка | ./stream | Каталог размещения скриптов DaJet Stream |
| Refresh | Число | 600 | Периодичность проверки изменения каталога размещения скриптов в секундах |

### Пример файла настроек сервиса config.json

```JSON
{
  "LogSize": 524288,
  "LogFile": "dajet-2024-08-01.log",
  "LogPath": "./log",
  "RootPath": "./scripts",
  "Refresh": 60
}
```

> Примеры скриптов DaJet Stream прилагаются в файле **dajet-stream-scripts.zip**

Каталог скриптов (_настройка **RootPath**_) может иметь любую структуру. Сервис будет искать скрипты DaJet, как в корневом, так и во всех вложенных в него каталогах. Поиск файлов скриптов DaJet Stream выполняется по шаблону *.djs (_то есть по расширению файла - **djs**_).

Каждый файл скрипта DaJet Stream (_конвейер обработки данных_) выполняется сервисом в отдельном потоке операционной системы параллельно и независимо друг от друга. Те скрипты, которые используют команду **CONSUME** выполняются **бесконечно** до полной остановки службы.

В текущей реализации логирование выполняется всеми конвейерами (_потоками выполнения_) в один файл службы, указанный в настройках. Макисмальный размер файла лога означает, что по его достижению файл перезаписывается с самого начала. Логирование действий сервиса имеет больше диагностическое значение для правильной настройки подключений к базам данных и внешним сервисам. Именно поэтому не имеет смысла делать лог большим - достаточно иметь информацию за последние 15-30 минут работы. Практика использования аналогичных сервисов DaJet показала, что такой подход вполне достаточен и удобен.

[Репозиторий исходного кода](https://github.com/zhichkin/dajet/tree/main/src/dajet)
