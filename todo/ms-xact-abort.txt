CREATE PROCEDURE insert_data @a int, @b int AS

  SET NOCOUNT ON;
  SET XACT_ABORT ON;

  BEGIN TRY
    BEGIN TRANSACTION;

    INSERT sometable(a, b) VALUES (@a, @b);
    INSERT sometable(a, b) VALUES (@b, @a);

    COMMIT TRANSACTION;
  END TRY
  BEGIN CATCH
    IF (@@TRANCOUNT > 0) ROLLBACK TRANSACTION;
    THROW;
  END CATCH