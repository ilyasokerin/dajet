INSERT INTO delivery_tracking_events
(msguid, source, event_type, event_node, event_time, event_data)
VALUES
(@msguid, @source, @event_type, @event_node, @event_time, @event_data)
ON CONFLICT (msguid, source, event_type, event_node)
--DO NOTHING
DO UPDATE SET
event_time = excluded.event_time,
event_data = excluded.event_data;

INSERT INTO delivery_tracking_events
(msguid, source, event_type, event_node, event_time, event_data)
SELECT
events.msguid, events.source, events.event_type,
events.event_node, events.event_time, events.event_data
FROM unnest(@delivery_events) AS events
ON CONFLICT (msguid, source, event_type, event_node)
--DO NOTHING
DO UPDATE SET
event_time = excluded.event_time,
event_data = excluded.event_data;